CREATE DATABASE steamhourboost_discord;
\c steamhourboost_discord;

CREATE TABLE license_type (
	type_id CHAR(4) NOT NULL PRIMARY KEY,
	description VARCHAR(50) NOT NULL,
	created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE discord_accounts (
  id SERIAL PRIMARY KEY,
	discord_id VARCHAR UNIQUE,
	account_type CHAR(4) REFERENCES license_type(type_id) ON UPDATE CASCADE,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE steam_accounts (
  id SERIAL PRIMARY KEY,
	owner_id INT NOT NULL REFERENCES discord_accounts(id) ON UPDATE CASCADE,
	is_running BOOLEAN NOT NULL DEFAULT FALSE,
	username VARCHAR NOT NULL UNIQUE,
	password VARCHAR[] NOT NULL,
	loginkey VARCHAR DEFAULT '',
	sharedsecret VARCHAR DEFAULT '',
	onlinestatus BOOLEAN NOT NULL DEFAULT TRUE,
	games VARCHAR[] DEFAULT '{}',
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE license_code (
  id SERIAL PRIMARY KEY,
	code VARCHAR(255) NOT NULL UNIQUE,
	type CHAR(4) REFERENCES license_type(type_id) ON UPDATE CASCADE,
	used_by INT	REFERENCES discord_accounts(id) ON UPDATE CASCADE,
  created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO license_type (type_id, description)
VALUES
('L001', 'Free'),
('L002', 'Premium');

